!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):"function"==typeof define&&define.amd?define(["uuid","point-in-polygon","earcut","simple-quadtree"],n):"object"==typeof exports?exports.nav2d=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):t.nav2d=n(t.uuid,t["point-in-polygon"],t.earcut,t["simple-quadtree"])}("undefined"!=typeof self?self:this,(function(t,n,e,r){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=4)}([function(n,e){n.exports=t},function(t,e){t.exports=n},function(t,n){t.exports=e},function(t,n){t.exports=r},function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n),e.d(n,"Point",(function(){return C})),e.d(n,"Vector",(function(){return i})),e.d(n,"isclose",(function(){return l})),e.d(n,"clip",(function(){return a})),e.d(n,"dot",(function(){return u})),e.d(n,"cross",(function(){return o})),e.d(n,"Edge",(function(){return A})),e.d(n,"Polygon",(function(){return M})),e.d(n,"NavMesh",(function(){return D}));var i=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var n,e,i;return n=t,(e=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return l(this.x,t.x)&&l(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(a(-1,1,u(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return o(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&r(n.prototype,e),i&&r(n,i),t}();function u(t,n){return t.x*n.x+t.y*n.y}function o(t,n){return t.x*n.y-t.y*n.x}function l(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return t>n-e&&t<n+e}function a(t,n,e){return e<t?t:e>n?n:e}var s=e(0),c=e(1),f=e.n(c),h=e(2),p=e.n(h),y=e(3),d=e.n(y);class v{constructor(t=[],n=g){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,u=n[i];if(e(r,u)>=0)break;n[t]=u,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),u=n[r];const o=r+1;if(o<this.length&&e(n[o],u)<0&&(r=o,u=n[o]),e(u,i)>=0)break;n[t]=u,t=r}n[t]=i}}function g(t,n){return t<n?-1:t>n?1:0}function b(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function _(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?b(Object(e),!0).forEach((function(n){m(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function w(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var e=[],r=!0,i=!1,u=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(e.push(o.value),!n||e.length!==n);r=!0);}catch(t){i=!0,u=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw u}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function x(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,n,e){return n&&k(t.prototype,n),e&&k(t,e),t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function j(t,n,e){return(j=P()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&E(i,e.prototype),i}).apply(null,arguments)}function E(t,n){return(E=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function S(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function q(t){return t instanceof Array?j(i,S(t)):t instanceof i?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new i(t.x,t.y):void 0}var A=function(){function t(n,e){x(this,t),this._uuid=Object(s.v4)(),this.p1=q(n),this.p2=q(e)}return O(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=q(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=u(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof i?t:t.p1.sub(t.p2);return l(o(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return l(o(n,e),0)&&l(o(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),j(t,S(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),M=function(){function t(n){x(this,t),this._uuid=Object(s.v4)(),this.points=n.map(q),this.bounds=this._computeBounds()}return O(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new A(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new i(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=q(t);var n=this.points.map(this._toPointArray);return f()(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=q(t);var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if(o.onEdge(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"touches",value:function(t){var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if((o.onEdge(t.p1)||o.onEdge(t.p2))&&o.collinear(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"boundsSize",value:function(){var t=w(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),D=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x(this,t),this._uuid=Object(s.v4)(),this.polygons=this._triangulate(n).map((function(t){return new M(t)})),this.costFunc=e,this.heuristicFunc=r,this._buildQuadtree(),this._buildNeighbors()}return O(t,[{key:"_triangulate",value:function(t){var n=this,e=[],r=!0,i=!1,u=void 0;try{for(var o,l=function(){for(var t=o.value,r=p()(n._flatten(t)),i=0;i<r.length/3;i++){var u=r.slice(3*i,3*i+3);e.push(u.map((function(n){return t[n]})))}},a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0)l()}catch(t){i=!0,u=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return e}},{key:"_flatten",value:function(t){var n=[],e=!0,r=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var l=u.value;l instanceof Array?n.push.apply(n,S(l)):n.push(l.x,l.y)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return n}},{key:"_buildQuadtree",value:function(){this.qt=d()(-1/0,-1/0,1/0,1/0);var t=!0,n=!1,e=void 0;try{for(var r,i=this.polygons[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var u=r.value;this.qt.put(_({},u.boundsSize(),{polygon:u}))}}catch(t){n=!0,e=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw e}}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t],e=!0,r=!1,i=void 0;try{for(var u,o=this.qt.get(n.boundsSize())[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var l=u.value.polygon;if(n!==l&&!n.neighbors.hasOwnProperty(l._uuid)){var a=this._computePortal(n,l);null!==a&&a.length()>0&&(n.neighbors[l._uuid]={polygon:l,portal:a},l.neighbors[n._uuid]={polygon:n,portal:a})}}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"_computePortal",value:function(t,n){var e=!0,r=!1,i=void 0;try{for(var u,o=t.edges()[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var l=u.value,a=n.touches(l);if(null!==a)return l.overlap(a)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return null}},{key:"findPath",value:function(t,n){t=q(t),n=q(n);var e=this._findPath(t,n);return e&&this._funnel(t,n,e)}},{key:"_findPath",value:function(t,n){var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);if(null===e||null===r)return null;for(var i=new v([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),u=m({},e._uuid,null),o=m({},e._uuid,0);i.length;){var l=i.pop().polygon;if(l._uuid===r._uuid)break;for(var a=0,s=Object.values(l.neighbors);a<s.length;a++){var c=s[a].polygon,f=o[l._uuid]+this._computeCost(l,c);(!o.hasOwnProperty(c._uuid)||f<o[c._uuid])&&(i.push({cost:f+this._heuristic(c,r),polygon:c}),o[c._uuid]=f,u[c._uuid]=l)}}return this._reconstructPath(r,u)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){if(null!==this.costFunc){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}return this._computeDistance(t,n)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:null!==this.heuristicFunc?this.heuristicFunc(t,n):this._computeDistance(t,n)}},{key:"_findContainingPolygon",value:function(t){var n=.01*t.x,e={x:.99*t.x-n,y:.99*t.y-n,w:2*n,h:2*n},r=!0,i=!1,u=void 0;try{for(var o,l=this.qt.get(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var a=o.value;if(a.polygon.contains(t))return a.polygon}}catch(t){i=!0,u=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw u}}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];for(var r=[t],i=null,u=null,o=0;o<e.length-1;o++){var l=e[o],a=e[o+1],s=l.neighbors[a._uuid].portal,c=w(this._pointPortalEdges(t,s),2),f=c[0],h=c[1];if(null!==i&&null!==u&&(f=this._funnelEdge(i,u,f),h=this._funnelEdge(u,i,h),null===f||null===h)){var p=null===f?u:i,y=this._splitAt(e.slice(o-1),p.p2);r.push.apply(r,S(this._funnel(p.p2,n,y)));break}if(i=f,u=h,o===e.length-2){var d=new A(t,n),v=this._funnelEdge(i,u,d);v===i?r.push(i.p2):null===v&&r.push(u.p2),r.push(n)}}return r}},{key:"_pointPortalEdges",value:function(t,n){return o(n.p1.sub(t),n.p2.sub(t))<0?[new A(t,n.p2),new A(t,n.p1)]:[new A(t,n.p1),new A(t,n.p2)]}},{key:"_splitAt",value:function(t,n){var e=t.indexOf(S(t).reverse().find((function(t){return t.contains(n)})));return t.slice(e)}},{key:"_funnelEdge",value:function(t,n,e){var r=t.direction(),i=n.direction(),u=e.direction();return o(r,i)*o(r,u)<0?t:r.angle(u)<=r.angle(i)?e:null}}]),t}(),C=i}])}));
//# sourceMappingURL=nav2d.min.js.map