!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):"function"==typeof define&&define.amd?define(["uuid","point-in-polygon","earcut","simple-quadtree"],n):"object"==typeof exports?exports.nav2d=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):t.nav2d=n(t.uuid,t["point-in-polygon"],t.earcut,t["simple-quadtree"])}("undefined"!=typeof self?self:this,(function(t,n,e,r){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=4)}([function(n,e){n.exports=t},function(t,e){t.exports=n},function(t,n){t.exports=e},function(t,n){t.exports=r},function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n),e.d(n,"Point",(function(){return M})),e.d(n,"Vector",(function(){return i})),e.d(n,"isclose",(function(){return l})),e.d(n,"clip",(function(){return a})),e.d(n,"dot",(function(){return o})),e.d(n,"cross",(function(){return u})),e.d(n,"Edge",(function(){return A})),e.d(n,"Polygon",(function(){return F})),e.d(n,"NavMesh",(function(){return T}));var i=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var n,e,i;return n=t,(e=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return l(this.x,t.x)&&l(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(a(-1,1,o(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return u(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&r(n.prototype,e),i&&r(n,i),t}();function o(t,n){return t.x*n.x+t.y*n.y}function u(t,n){return t.x*n.y-t.y*n.x}function l(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return t>n-e&&t<n+e}function a(t,n,e){return e<t?t:e>n?n:e}var s=e(0),c=e(1),h=e.n(c),f=e(2),p=e.n(f),y=e(3),d=e.n(y);class v{constructor(t=[],n=g){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,o=n[i];if(e(r,o)>=0)break;n[t]=o,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),o=n[r];const u=r+1;if(u<this.length&&e(n[u],o)<0&&(r=u,o=n[u]),e(o,i)>=0)break;n[t]=o,t=r}n[t]=i}}function g(t,n){return t<n?-1:t>n?1:0}function b(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function _(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?b(Object(e),!0).forEach((function(n){m(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function x(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t))&&"[object Arguments]"!==Object.prototype.toString.call(t))return;var e=[],r=!0,i=!1,o=void 0;try{for(var u,l=t[Symbol.iterator]();!(r=(u=l.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,n,e){return n&&k(t.prototype,n),e&&k(t,e),t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function j(t,n,e){return(j=P()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&S(i,e.prototype),i}).apply(null,arguments)}function S(t,n){return(S=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function q(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(t){return t instanceof Array?j(i,q(t)):t instanceof i?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new i(t.x,t.y):void 0}var A=function(){function t(n,e){w(this,t),this._uuid=Object(s.v4)(),this.p1=E(n),this.p2=E(e)}return O(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=E(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=o(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof i?t:t.p1.sub(t.p2);return l(u(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return l(u(n,e),0)&&l(u(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),j(t,q(e))):null}},{key:"distanceToPoint",value:function(t){var n=o(this.p2.sub(this.p1),this.p2.sub(this.p1)),e=o(this.p2.sub(this.p1),t.sub(this.p1));return(e/=n)<0?t.sub(this.p1).length():e>1?t.sub(this.p2).length():Math.sqrt(o(t.sub(this.p1),t.sub(this.p1))-e*e*n)}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),F=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";w(this,t),this._uuid=Object(s.v4)(),this.points=n.map(E),this.bounds=this._computeBounds(),this.group=e}return O(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new A(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new i(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=E(t);var n=this.points.map(this._toPointArray);return h()(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=E(t);var n=!0,e=!1,r=void 0;try{for(var i,o=this.edges()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value;if(u.onEdge(t))return u}}catch(t){e=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw r}}return null}},{key:"touches",value:function(t){var n=!0,e=!1,r=void 0;try{for(var i,o=this.edges()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value;if((u.onEdge(t.p1)||u.onEdge(t.p2))&&u.collinear(t))return u}}catch(t){e=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw r}}return null}},{key:"distanceToPoint",value:function(t){var n=1/0,e=!0,r=!1,i=void 0;try{for(var o,u=this.edges()[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value.distanceToPoint(t);l<n&&(n=l)}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}return n}},{key:"boundsSize",value:function(){var t=x(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),T=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;w(this,t),this._uuid=Object(s.v4)(),this.polygons=this._triangulate(n),this.costFunc=e,this.heuristicFunc=r,this.fromTolerance=i,this.toTolerance=o,this.pointQuerySize=.01,this._buildQuadtree(),this._buildNeighbors()}return O(t,[{key:"_triangulate",value:function(t){var n=this;Array.isArray(t)&&(t={default:t});var e=[];for(var r in t){var o=!0,u=!1,l=void 0;try{for(var a,s=function(){for(var t=a.value,o=n._flatten(t),u=o.vertices,l=o.holes,s=p()(u,l),c=0;c<s.length/3;c++){var h=s.slice(3*c,3*c+3);e.push(new F(h.map((function(t){return new i(u[2*t],u[2*t+1])})),r))}},c=t[r][Symbol.iterator]();!(o=(a=c.next()).done);o=!0)s()}catch(t){u=!0,l=t}finally{try{o||null==c.return||c.return()}finally{if(u)throw l}}}return e}},{key:"_flatten",value:function(t){void 0===t[0].x&&"number"!=typeof t[0][0]||(t=[t]);for(var n={vertices:[],holes:[]},e=0,r=0;r<t.length;r++){var i=!0,o=!1,u=void 0;try{for(var l,a=t[r][Symbol.iterator]();!(i=(l=a.next()).done);i=!0){var s,c=l.value;if(c instanceof Array)(s=n.vertices).push.apply(s,q(c));else n.vertices.push(c.x,c.y)}}catch(t){o=!0,u=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw u}}r>0&&(e+=t[r-1].length,n.holes.push(e))}return n}},{key:"_buildQuadtree",value:function(){this.qt=d()(-1/0,-1/0,1/0,1/0);var t=!0,n=!1,e=void 0;try{for(var r,i=this.polygons[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;this.qt.put(_(_({},o.boundsSize()),{},{polygon:o}))}}catch(t){n=!0,e=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw e}}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t],e=!0,r=!1,i=void 0;try{for(var o,u=this.qt.get(n.boundsSize())[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value.polygon;if(n!==l&&!n.neighbors.hasOwnProperty(l._uuid)){var a=this._computePortal(n,l);if(null!==a&&a.length()>0){var s=x(this._orderLeftRight(n.centroid(),a.p1,a.p2),2),c=s[0],h=s[1];n.neighbors[l._uuid]={polygon:l,portal:new A(c,h)},l.neighbors[n._uuid]={polygon:n,portal:new A(h,c)}}}}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}}}},{key:"_computePortal",value:function(t,n){var e=!0,r=!1,i=void 0;try{for(var o,u=t.edges()[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value,a=n.touches(l);if(null!==a)return l.overlap(a)}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}return null}},{key:"findPath",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=E(t),n=E(n);var r=this._findPath(t,n,e);return r&&this._funnel(t,n,r)}},{key:"_findPath",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this._findClosestPolygon(t,this.fromTolerance,e),i=this._findClosestPolygon(n,this.toTolerance,e);if(null===r||null===i)return null;for(var o=new v([{cost:0,polygon:r}],(function(t,n){return t.cost-n.cost})),u=m({},r._uuid,null),l=m({},r._uuid,0);o.length;){var a=o.pop().polygon;if(a._uuid===i._uuid)break;for(var s=0,c=Object.values(a.neighbors);s<c.length;s++){var h=c[s].polygon;if(!e||e.includes(h.group)){var f=l[a._uuid]+this._computeCost(a,h);(!l.hasOwnProperty(h._uuid)||f<l[h._uuid])&&(o.push({cost:f+this._heuristic(h,i),polygon:h}),l[h._uuid]=f,u[h._uuid]=a)}}}return this._reconstructPath(i,u)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){if(null!==this.costFunc){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}return this._computeDistance(t,n)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:null!==this.heuristicFunc?this.heuristicFunc(t,n):this._computeDistance(t,n)}},{key:"_findContainingPolygon",value:function(t,n){var e=this.pointQuerySize/2,r={x:t.x-e,y:t.y-e,w:this.pointQuerySize,h:this.pointQuerySize},i=!0,o=!1,u=void 0;try{for(var l,a=this.qt.get(r)[Symbol.iterator]();!(i=(l=a.next()).done);i=!0){var s=l.value;if(s.polygon.contains(t)&&(!n||n.includes(s.polygon.group)))return s.polygon}}catch(t){o=!0,u=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw u}}return null}},{key:"_findClosestPolygon",value:function(t,n,e){if(n<this.pointQuerySize/2)return this._findContainingPolygon(t,e);var r=this._findContainingPolygon(t,e);if(r)return r;var i={x:t.x-n/2,y:t.y-n/2,w:n,h:n},o=1/0,u=null,l=!0,a=!1,s=void 0;try{for(var c,h=this.qt.get(i)[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;if(!e||e.includes(f.polygon.group)){var p=f.polygon.distanceToPoint(t);p<o&&(u=f,o=p)}}}catch(t){a=!0,s=t}finally{try{l||null==h.return||h.return()}finally{if(a)throw s}}return null===u?null:u.polygon}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];var r=[t],i=[],o=[],u=e[0].neighbors[e[1]._uuid].portal;i.push(u.p1),o.push(u.p2);for(var l=1;l<e.length-1;l++){var a=e[l],s=e[l+1],c=a.neighbors[s._uuid].portal;this._extendFunnel(r,i,o,c.p1,c.p2)}return this._extendFunnel(r,i,o,n,n),r}},{key:"_extendFunnel",value:function(t,n,e,r,i){this._extendFunnelSide(t,n,e,!0,r),this._extendFunnelSide(t,n,e,!1,i)}},{key:"_extendFunnelSide",value:function(t,n,e,r,i){var o=t[t.length-1];if(!r){var u=[e,n];n=u[0],e=u[1]}var l=0===n.length?t[t.length-1]:n[n.length-1];if(!i.equals(l)){var a=this._findFirstLeftOfPoint(o,n,i,!0,!r);if(n.length=a,n.push(i),0===a){var s=this._findFirstLeftOfPoint(o,e,i,!1,r);t.push.apply(t,q(e.splice(0,s)))}}}},{key:"_findFirstLeftOfPoint",value:function(t,n,e,r,i){var o;for(o=0;o<n.length;o++){if(i?this._isInLeftRightOrder(t,e,n[o],r):this._isInLeftRightOrder(t,n[o],e,r))return o}return o}},{key:"_isInLeftRightOrder",value:function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=n.sub(t),o=e.sub(t),l=u(i,o);return r?l<=0:l<0}},{key:"_orderLeftRight",value:function(t,n,e){return this._isInLeftRightOrder(t,n,e)?[n,e]:[e,n]}}]),t}(),M=i}])}));
//# sourceMappingURL=nav2d.min.js.map