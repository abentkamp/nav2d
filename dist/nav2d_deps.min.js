!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.nav2d=n():t.nav2d=n()}("undefined"!=typeof self?self:this,(function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=3)}([function(t,n){t.exports=function(t,n){for(var e=t[0],r=t[1],i=!1,o=0,u=n.length-1;o<n.length;u=o++){var l=n[o][0],a=n[o][1],f=n[u][0],s=n[u][1];a>r!=s>r&&e<(f-l)*(r-a)/(s-a)+l&&(i=!i)}return i}},function(t,n,e){"use strict";function r(t,n,e){e=e||2;var r,l,a,f,s,y,p,x=n&&n.length,d=x?n[0]*e:t.length,g=i(t,0,d,e,!0),b=[];if(!g||g.next===g.prev)return b;if(x&&(g=function(t,n,e,r){var u,l,a,f,s,y=[];for(u=0,l=n.length;u<l;u++)a=n[u]*r,f=u<l-1?n[u+1]*r:t.length,(s=i(t,a,f,r,!1))===s.next&&(s.steiner=!0),y.push(v(s));for(y.sort(c),u=0;u<y.length;u++)h(y[u],e),e=o(e,e.next);return e}(t,n,g,e)),t.length>80*e){r=a=t[0],l=f=t[1];for(var m=e;m<d;m+=e)(s=t[m])<r&&(r=s),(y=t[m+1])<l&&(l=y),s>a&&(a=s),y>f&&(f=y);p=0!==(p=Math.max(a-r,f-l))?1/p:0}return u(g,b,e,r,l,p),b}function i(t,n,e,r,i){var o,u;if(i===N(t,n,e,r)>0)for(o=n;o<e;o+=r)u=P(o,t[o],t[o+1],u);else for(o=e-r;o>=n;o-=r)u=P(o,t[o],t[o+1],u);return u&&b(u,u.next)&&(j(u),u=u.next),u}function o(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!b(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(j(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function u(t,n,e,r,i,c,h){if(t){!h&&c&&function(t,n,e,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,o,u,l,a,f=1;do{for(e=t,t=null,o=null,u=0;e;){for(u++,r=e,l=0,n=0;n<f&&(l++,r=r.nextZ);n++);for(a=f;l>0||a>0&&r;)0!==l&&(0===a||!r||e.z<=r.z)?(i=e,e=e.nextZ,l--):(i=r,r=r.nextZ,a--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;e=r}o.nextZ=null,f*=2}while(u>1)}(i)}(t,r,i,c);for(var y,v,x=t;t.prev!==t.next;)if(y=t.prev,v=t.next,c?a(t,r,i,c):l(t))n.push(y.i/e),n.push(t.i/e),n.push(v.i/e),j(t),t=v.next,x=v.next;else if((t=v)===x){h?1===h?u(t=f(o(t),n,e),n,e,r,i,c,2):2===h&&s(t,n,e,r,i,c):u(o(t),n,e,r,i,c,1);break}}}function l(t){var n=t.prev,e=t,r=t.next;if(g(n,e,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(x(n.x,n.y,e.x,e.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(t,n,e,r){var i=t.prev,o=t,u=t.next;if(g(i,o,u)>=0)return!1;for(var l=i.x<o.x?i.x<u.x?i.x:u.x:o.x<u.x?o.x:u.x,a=i.y<o.y?i.y<u.y?i.y:u.y:o.y<u.y?o.y:u.y,f=i.x>o.x?i.x>u.x?i.x:u.x:o.x>u.x?o.x:u.x,s=i.y>o.y?i.y>u.y?i.y:u.y:o.y>u.y?o.y:u.y,c=p(l,a,n,e,r),h=p(f,s,n,e,r),y=t.prevZ,v=t.nextZ;y&&y.z>=c&&v&&v.z<=h;){if(y!==t.prev&&y!==t.next&&x(i.x,i.y,o.x,o.y,u.x,u.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v!==t.prev&&v!==t.next&&x(i.x,i.y,o.x,o.y,u.x,u.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=c;){if(y!==t.prev&&y!==t.next&&x(i.x,i.y,o.x,o.y,u.x,u.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=h;){if(v!==t.prev&&v!==t.next&&x(i.x,i.y,o.x,o.y,u.x,u.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function f(t,n,e){var r=t;do{var i=r.prev,u=r.next.next;!b(i,u)&&m(i,r,r.next,u)&&k(i,u)&&k(u,i)&&(n.push(i.i/e),n.push(r.i/e),n.push(u.i/e),j(r),j(r.next),r=t=u),r=r.next}while(r!==t);return o(r)}function s(t,n,e,r,i,l){var a=t;do{for(var f=a.next.next;f!==a.prev;){if(a.i!==f.i&&d(a,f)){var s=O(a,f);return a=o(a,a.next),s=o(s,s.next),u(a,n,e,r,i,l),void u(s,n,e,r,i,l)}f=f.next}a=a.next}while(a!==t)}function c(t,n){return t.x-n.x}function h(t,n){if(n=function(t,n){var e,r=n,i=t.x,o=t.y,u=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var l=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=i&&l>u){if(u=l,l===i){if(o===r.y)return r;if(o===r.next.y)return r.next}e=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!e)return null;if(i===u)return e;var a,f=e,s=e.x,c=e.y,h=1/0;r=e;do{i>=r.x&&r.x>=s&&i!==r.x&&x(o<c?i:u,o,s,c,o<c?u:i,o,r.x,r.y)&&(a=Math.abs(o-r.y)/(i-r.x),k(r,t)&&(a<h||a===h&&(r.x>e.x||r.x===e.x&&y(e,r)))&&(e=r,h=a)),r=r.next}while(r!==f);return e}(t,n)){var e=O(n,t);o(n,n.next),o(e,e.next)}}function y(t,n){return g(t.prev,t,n.prev)<0&&g(n.next,t,t.next)<0}function p(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-e)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function v(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function x(t,n,e,r,i,o,u,l){return(i-u)*(n-l)-(t-u)*(o-l)>=0&&(t-u)*(r-l)-(e-u)*(n-l)>=0&&(e-u)*(o-l)-(i-u)*(r-l)>=0}function d(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&m(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(k(t,n)&&k(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,o=(t.y+n.y)/2;do{e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(g(t.prev,t,n.prev)||g(t,n.prev,n))||b(t,n)&&g(t.prev,t,t.next)>0&&g(n.prev,n,n.next)>0)}function g(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function b(t,n){return t.x===n.x&&t.y===n.y}function m(t,n,e,r){var i=_(g(t,n,e)),o=_(g(t,n,r)),u=_(g(e,r,t)),l=_(g(e,r,n));return i!==o&&u!==l||(!(0!==i||!w(t,e,n))||(!(0!==o||!w(t,r,n))||(!(0!==u||!w(e,t,r))||!(0!==l||!w(e,n,r)))))}function w(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function _(t){return t>0?1:t<0?-1:0}function k(t,n){return g(t.prev,t,t.next)<0?g(t,n,t.next)>=0&&g(t,t.prev,n)>=0:g(t,n,t.prev)<0||g(t,t.next,n)<0}function O(t,n){var e=new S(t.i,t.x,t.y),r=new S(n.i,n.x,n.y),i=t.next,o=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function P(t,n,e,r){var i=new S(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function j(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function N(t,n,e,r){for(var i=0,o=n,u=e-r;o<e;o+=r)i+=(t[u]-t[o])*(t[o+1]+t[u+1]),u=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,n,e,r){var i=n&&n.length,o=i?n[0]*e:t.length,u=Math.abs(N(t,0,o,e));if(i)for(var l=0,a=n.length;l<a;l++){var f=n[l]*e,s=l<a-1?n[l+1]*e:t.length;u-=Math.abs(N(t,f,s,e))}var c=0;for(l=0;l<r.length;l+=3){var h=r[l]*e,y=r[l+1]*e,p=r[l+2]*e;c+=Math.abs((t[h]-t[p])*(t[y+1]-t[h+1])-(t[h]-t[y])*(t[p+1]-t[h+1]))}return 0===u&&0===c?0:Math.abs((c-u)/u)},r.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var u=0;u<n;u++)e.vertices.push(t[i][o][u]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e}},function(t,n,e){t.exports=function(t,n,e,r,i){("number"!=typeof t||isNaN(t))&&(t=0),("number"!=typeof n||isNaN(n))&&(n=0),("number"!=typeof e||isNaN(e))&&(e=10),("number"!=typeof r||isNaN(r))&&(r=10);var o=25,u=.5;function l(t){return!!t&&("number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.w&&"number"==typeof t.h&&(!(isNaN(t.x)||isNaN(t.y)||isNaN(t.w)||isNaN(t.h))&&!(t.w<0||t.h<0)))}function a(t,n){return t.x==n.x&&t.y==n.y&&t.w==n.w&&t.h==n.h}function f(t,n,e,r){return{x:t,y:n,w:e,h:r,c:[],l:[],n:[]}}i&&("number"==typeof i.maxchildren&&i.maxchildren>0&&(o=i.maxchildren),"number"==typeof i.leafratio&&i.leafratio>=0&&(u=i.leafratio));var s=f(t,n,e,r);function c(t,n,e,r){return Math.sqrt((e-t)*(e-t)+(r-n)*(r-n))}function h(t,n,e){if(!t||!n)return!0;var r=function(t,n,e,r,i,o,u){u||(u=-1);var l=i*i+o*o;if(0==l)return null;if(l=(t*o-n*i-e*o+r*i)/l,Math.abs(i)>Math.abs(o))var a=(t-e-l*o)/i;else a=(n-r+l*i)/o;return a>=0&&a<=u||u<0?{s:a,t:l,x:e+a*i,y:r+a*o,dist:Math.abs(l)}:a<0?{s:a,dist:c(t,n,e,r)}:{s:a,dist:c(t,n,e+u*i,r+u*o)}}(n.x+.5*n.w,n.y+.5*n.h,t.x,t.y,t.dx,t.dy,t.dist);if(r){if(r.dist-=e,r.dist<0)return!0;if(r.dist*r.dist<=n.w*n.w+n.h*n.h)return!0}return!1}function y(t,n,e){return!t||!n||!(t.x+t.w<n.x-e||t.y+t.h<n.y-e||t.x-e>n.x+n.w||t.y-e>n.y+n.h)}function p(t,n){var e=!1;n.w*n.h>t.w*t.h*u&&(e=!0),(n.x<t.x||n.y<t.y||n.x+n.w>t.x+t.w||n.y+n.h>t.y+t.h)&&(e=!0);for(var r=null,i=0;i<t.n.length;i++)if(y(n,t.n[i],0)){if(r){e=!0;break}r=t.n[i]}return{leaf:e,childnode:r}}function v(t,n){var e=p(t,n);if(e.leaf)t.l.push(n);else{if(!e.childnode)return;d(e.childnode,n)}}function x(t,n){t.x="number"==typeof n.x?n.x:t.x,t.y="number"==typeof n.y?n.y:t.y,t.w="number"==typeof n.w?n.w:t.w,t.h="number"==typeof n.h?n.h:t.h}function d(t,n){if(l(n))if(0==t.n.length){if(t.c.push(n),t.c.length>o){var e=t.w/2,r=t.h/2;t.n.push(f(t.x,t.y,e,r),f(t.x+e,t.y,e,r),f(t.x,t.y+r,e,r),f(t.x+e,t.y+r,e,r));for(var i=0;i<t.c.length;i++)v(t,t.c[i]);t.c=[]}}else v(t,n)}function g(t,n,e,r,i,o){for(var u=0;u<n.l.length;u++)if(!i||t(e,n.l[u],r))if("object"==typeof o)o.push(n.l[u]);else if(!o(n.l[u]))return!1;for(u=0;u<n.c.length;u++)if(!i||t(e,n.c[u],r))if("object"==typeof o)o.push(n.c[u]);else if(!o(n.c[u]))return!1;for(var l=0;l<n.n.length;l++)if(t(e,n.n[l],r))if("object"==typeof o)o.concat(g(t,n.n[l],e,r,i,o));else if(!g(t,n.n[l],e,r,i,o))return!1;return!0}function b(t,n,e,r){return g(y,t,n,e,!0,r)}function m(t,n,e,r){if("function"!=typeof e&&"object"!=typeof e||void 0!==r||(r=e,e=0),void 0===r&&(r=[],e=0),null==n?b(t,n,e,r):"number"!=typeof n.x||"number"!=typeof n.y||isNaN(n.x)||isNaN(n.y)||("number"!=typeof n.dx||"number"!=typeof n.dy||isNaN(n.dx)||isNaN(n.dy)?"number"!=typeof n.w||"number"!=typeof n.h||isNaN(n.w)||isNaN(n.h)||b(t,n,e,r):function(t,n,e,r){g(h,t,n,e,!1,r)}(t,n,e,r)),"object"==typeof r)return r}return{get:function(t,n,e){return m(s,t,n,e)},put:function(t){d(s,t)},update:function(t,n,e){return function t(n,e,r,i){if("object"==typeof r&&void 0===i&&(i=r,r=!1),!l(e)||void 0===i)return!1;r?"string"!=typeof r&&(r="id"):r=!1;for(var o=0;o<n.c.length;o++)if(r&&n.c[o][r]==e[r]||!r&&a(n.c[o],e)){return x(u=n.c[o],i),(u.x>n.x+n.w||u.y>n.y+n.h||u.x+u.w<n.x||u.y+u.h<n.y)&&(n.c.splice(o,1),d(s,u)),!0}for(o=0;o<n.l.length;o++)if(r&&n.l[o][r]==e[r]||!r&&a(n.l[o],e)){var u;return x(u=n.l[o],i),(u.x>n.x+n.w||u.y>n.y+n.h||u.x+u.w<n.x||u.y+u.h<n.y)&&(n.l.splice(o,1),d(s,u)),!0}var f=p(n,e);return!(f.leaf||!f.childnode||!t(f.childnode,e,r))}(s,t,n,e)},remove:function(t,n){return function t(n,e,r){if(!l(e))return 0;r?"string"!=typeof r&&(r="id"):r=!1;for(var i=0,o=0;o<n.c.length;o++)(r&&n.c[o][r]==e[r]||!r&&a(n.c[o],e))&&(i++,n.c.splice(o,1),o--);for(o=0;o<n.l.length;o++)(r&&n.l[o][r]==e[r]||!r&&a(n.l[o],e))&&(i++,n.l.splice(o,1),o--);var u=p(n,e);return!u.leaf&&u.childnode?i+t(u.childnode,e,r):i}(s,t,n)},clear:function(){s=f(t,n,e,r)},stringify:function(){var i={x:t,y:n,w:e,h:r,maxc:o,leafratio:u,root:s};try{return JSON.stringify(i)}catch(t){return null}},parse:function(i){"string"==typeof i&&(i=JSON.parse(i)),t=i.x,n=i.y,e=i.w,r=i.h,o=i.maxc,u=i.leafratio,s=i.root}}}},function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n),e.d(n,"Point",(function(){return T})),e.d(n,"Vector",(function(){return i})),e.d(n,"isclose",(function(){return l})),e.d(n,"clip",(function(){return a})),e.d(n,"dot",(function(){return o})),e.d(n,"cross",(function(){return u})),e.d(n,"Edge",(function(){return D})),e.d(n,"Polygon",(function(){return I})),e.d(n,"NavMesh",(function(){return L}));var i=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var n,e,i;return n=t,(e=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return l(this.x,t.x)&&l(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(a(-1,1,o(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return u(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&r(n.prototype,e),i&&r(n,i),t}();function o(t,n){return t.x*n.x+t.y*n.y}function u(t,n){return t.x*n.y-t.y*n.x}function l(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return t>n-e&&t<n+e}function a(t,n,e){return e<t?t:e>n?n:e}var f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),s=new Uint8Array(16);function c(){if(!f)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(s)}var h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var y=function(t){return"string"==typeof t&&h.test(t)},p=[],v=0;v<256;++v)p.push((v+256).toString(16).substr(1));var x=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(p[t[n+0]]+p[t[n+1]]+p[t[n+2]]+p[t[n+3]]+"-"+p[t[n+4]]+p[t[n+5]]+"-"+p[t[n+6]]+p[t[n+7]]+"-"+p[t[n+8]]+p[t[n+9]]+"-"+p[t[n+10]]+p[t[n+11]]+p[t[n+12]]+p[t[n+13]]+p[t[n+14]]+p[t[n+15]]).toLowerCase();if(!y(e))throw TypeError("Stringified UUID is invalid");return e};var d=function(t,n,e){var r=(t=t||{}).random||(t.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){e=e||0;for(var i=0;i<16;++i)n[e+i]=r[i];return n}return x(r)},g=e(0),b=e.n(g),m=e(1),w=e.n(m),_=e(2),k=e.n(_);class O{constructor(t=[],n=P){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,o=n[i];if(e(r,o)>=0)break;n[t]=o,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),o=n[r];const u=r+1;if(u<this.length&&e(n[u],o)<0&&(r=u,o=n[u]),e(o,i)>=0)break;n[t]=o,t=r}n[t]=i}}function P(t,n){return t<n?-1:t>n?1:0}function j(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function S(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?j(Object(e),!0).forEach((function(n){N(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):j(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function N(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function E(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t))&&"[object Arguments]"!==Object.prototype.toString.call(t))return;var e=[],r=!0,i=!1,o=void 0;try{for(var u,l=t[Symbol.iterator]();!(r=(u=l.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Z(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function M(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t,n,e){return n&&M(t.prototype,n),e&&M(t,e),t}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function z(t,n,e){return(z=A()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&R(i,e.prototype),i}).apply(null,arguments)}function R(t,n){return(R=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function C(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function F(t){return t instanceof Array?z(i,C(t)):t instanceof i?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new i(t.x,t.y):void 0}var D=function(){function t(n,e){Z(this,t),this._uuid=d(),this.p1=F(n),this.p2=F(e)}return q(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=F(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=o(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof i?t:t.p1.sub(t.p2);return l(u(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return l(u(n,e),0)&&l(u(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),z(t,C(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),I=function(){function t(n){Z(this,t),this._uuid=d(),this.points=n.map(F),this.bounds=this._computeBounds()}return q(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new D(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new i(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=F(t);var n=this.points.map(this._toPointArray);return b()(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=F(t);var n=!0,e=!1,r=void 0;try{for(var i,o=this.edges()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value;if(u.onEdge(t))return u}}catch(t){e=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw r}}return null}},{key:"touches",value:function(t){var n=!0,e=!1,r=void 0;try{for(var i,o=this.edges()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value;if((u.onEdge(t.p1)||u.onEdge(t.p2))&&u.collinear(t))return u}}catch(t){e=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(e)throw r}}return null}},{key:"boundsSize",value:function(){var t=E(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),L=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z(this,t),this._uuid=d(),this.polygons=this._triangulate(n).map((function(t){return new I(t)})),this.costFunc=e,this.heuristicFunc=r,this.pointQuerySize=.01,this._buildQuadtree(),this._buildNeighbors()}return q(t,[{key:"_triangulate",value:function(t){var n=this,e=[],r=!0,i=!1,o=void 0;try{for(var u,l=function(){for(var t=u.value,r=w()(n._flatten(t)),i=0;i<r.length/3;i++){var o=r.slice(3*i,3*i+3);e.push(o.map((function(n){return t[n]})))}},a=t[Symbol.iterator]();!(r=(u=a.next()).done);r=!0)l()}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return e}},{key:"_flatten",value:function(t){var n=[],e=!0,r=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value;l instanceof Array?n.push.apply(n,C(l)):n.push(l.x,l.y)}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}return n}},{key:"_buildQuadtree",value:function(){this.qt=k()(-1/0,-1/0,1/0,1/0);var t=!0,n=!1,e=void 0;try{for(var r,i=this.polygons[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;this.qt.put(S(S({},o.boundsSize()),{},{polygon:o}))}}catch(t){n=!0,e=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw e}}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t],e=!0,r=!1,i=void 0;try{for(var o,u=this.qt.get(n.boundsSize())[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value.polygon;if(n!==l&&!n.neighbors.hasOwnProperty(l._uuid)){var a=this._computePortal(n,l);null!==a&&a.length()>0&&(n.neighbors[l._uuid]={polygon:l,portal:a},l.neighbors[n._uuid]={polygon:n,portal:a})}}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}}}},{key:"_computePortal",value:function(t,n){var e=!0,r=!1,i=void 0;try{for(var o,u=t.edges()[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){var l=o.value,a=n.touches(l);if(null!==a)return l.overlap(a)}}catch(t){r=!0,i=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw i}}return null}},{key:"findPath",value:function(t,n){t=F(t),n=F(n);var e=this._findPath(t,n);return e&&this._funnel(t,n,e)}},{key:"_findPath",value:function(t,n){t=F(t),n=F(n);var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);if(null===e||null===r)return null;for(var i=new O([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),o=N({},e._uuid,null),u=N({},e._uuid,0);i.length;){var l=i.pop().polygon;if(l._uuid===r._uuid)break;for(var a=0,f=Object.values(l.neighbors);a<f.length;a++){var s=f[a].polygon,c=u[l._uuid]+this._computeCost(l,s);(!u.hasOwnProperty(s._uuid)||c<u[s._uuid])&&(i.push({cost:c+this._heuristic(s,r),polygon:s}),u[s._uuid]=c,o[s._uuid]=l)}}return this._reconstructPath(r,o)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){if(null!==this.costFunc){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}return this._computeDistance(t,n)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:null!==this.heuristicFunc?this.heuristicFunc(t,n):this._computeDistance(t,n)}},{key:"_findContainingPolygon",value:function(t){var n=this.pointQuerySize/2,e={x:t.x-n,y:t.y-n,w:this.pointQuerySize,h:this.pointQuerySize},r=!0,i=!1,o=void 0;try{for(var u,l=this.qt.get(e)[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var a=u.value;if(a.polygon.contains(t))return a.polygon}}catch(t){i=!0,o=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(console.log("Funnel start"),console.log(e),0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];var r=[t],i=[],o=[],u=e[0].neighbors[e[1]._uuid].portal,l=E(this._orderLeftRight(t,u.p1,u.p2),2),a=l[0],f=l[1];i.push(a),o.push(f);for(var s=1;s<e.length-2;s++){console.log("Iteration ".concat(s)),console.log(r),console.log(i),console.log(o);var c=e[s],h=e[s+1],y=c.neighbors[h._uuid].portal;console.log(y);var p=0===i.length?r[r.length-1]:i[i.length-1],v=0===o.length?r[r.length-1]:o[o.length-1],x=void 0,d=void 0;if(y.p1.equals(p))x=!1,d=y.p2;else if(y.p2.equals(p))x=!1,d=y.p1;else if(y.p1.equals(v))x=!0,d=y.p2;else{if(!y.p2.equals(v))throw new Error("Invalid portal: Funnel cannot be extended on both sides at once.");x=!0,d=y.p1}this._extendFunnel(r,i,o,x,d)}return this._extendFunnel(r,i,o,!0,n),this._extendFunnel(r,i,o,!1,n),r}},{key:"_extendFunnel",value:function(t,n,e,r,i){var o=t[t.length-1];if(!r){var u=[e,n];n=u[0],e=u[1]}for(var l=0;l<n.length&&this._isInLeftRightOrder(o,i,n[l],!r);)l++;if(n.length=l,n.push(i),0===l){for(var a=0;a<e.length&&!this._isInLeftRightOrder(o,i,e[a],!r);)a++;t.push.apply(t,C(e.splice(0,a)))}}},{key:"_funnel_old",value:function(t,n,e){if(console.log("start funnel"),console.log(e),0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];for(var r=[t],i=null,o=null,u=0;u<e.length-1;u++){console.log("Start iteration ".concat(u));var l=e[u],a=e[u+1],f=l.neighbors[a._uuid].portal,s=E(this._pointPortalEdges(t,f),2),c=s[0],h=s[1];if(null!==i&&null!==o&&(c=this._funnelEdge(i,o,c),h=this._funnelEdge(o,i,h),null===c||null===h)){var y=null===c?o:i,p=this._splitAt(e,y.p2,u-1);console.log("Start recursion"),r.push.apply(r,C(this._funnel(y.p2,n,p))),console.log("End recursion");break}if(i=c,o=h,u===e.length-2){var v=new D(t,n),x=this._funnelEdge(i,o,v);x===i?r.push(i.p2):null===x&&r.push(o.p2),r.push(n)}}return r}},{key:"_pointPortalEdges",value:function(t,n){return u(n.p1.sub(t),n.p2.sub(t))<0?[new D(t,n.p2),new D(t,n.p1)]:[new D(t,n.p1),new D(t,n.p2)]}},{key:"_isInLeftRightOrder",value:function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r){var i=[e,n];n=i[0],e=i[1]}var o=n.sub(t),l=e.sub(t);return u(o,l)>0}},{key:"_orderLeftRight",value:function(t,n,e){return this._isInLeftRightOrder(t,n,e)?[n,e]:[e,n]}},{key:"_splitAt",value:function(t,n,e){var r=t.indexOf(C(t).reverse().find((function(t){return t.contains(n)})));return t.slice(r)}},{key:"_funnelEdge",value:function(t,n,e){var r=t.direction(),i=n.direction(),o=e.direction();return u(r,i)*u(r,o)<0?t:r.angle(o)<=r.angle(i)?e:null}}]),t}(),T=i}])}));
//# sourceMappingURL=nav2d_deps.min.js.map