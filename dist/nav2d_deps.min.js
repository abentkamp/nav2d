!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.nav2d=n():t.nav2d=n()}("undefined"!=typeof self?self:this,(function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=3)}([function(t,n){t.exports=function(t,n){for(var e=t[0],r=t[1],i=!1,u=0,o=n.length-1;u<n.length;o=u++){var a=n[u][0],l=n[u][1],f=n[o][0],s=n[o][1];l>r!=s>r&&e<(f-a)*(r-l)/(s-l)+a&&(i=!i)}return i}},function(t,n,e){"use strict";function r(t,n,e){e=e||2;var r,a,l,f,s,y,p,x=n&&n.length,d=x?n[0]*e:t.length,g=i(t,0,d,e,!0),b=[];if(!g||g.next===g.prev)return b;if(x&&(g=function(t,n,e,r){var o,a,l,f,s,y=[];for(o=0,a=n.length;o<a;o++)l=n[o]*r,f=o<a-1?n[o+1]*r:t.length,(s=i(t,l,f,r,!1))===s.next&&(s.steiner=!0),y.push(v(s));for(y.sort(c),o=0;o<y.length;o++)h(y[o],e),e=u(e,e.next);return e}(t,n,g,e)),t.length>80*e){r=l=t[0],a=f=t[1];for(var m=e;m<d;m+=e)(s=t[m])<r&&(r=s),(y=t[m+1])<a&&(a=y),s>l&&(l=s),y>f&&(f=y);p=0!==(p=Math.max(l-r,f-a))?1/p:0}return o(g,b,e,r,a,p),b}function i(t,n,e,r,i){var u,o;if(i===S(t,n,e,r)>0)for(u=n;u<e;u+=r)o=P(u,t[u],t[u+1],o);else for(u=e-r;u>=n;u-=r)o=P(u,t[u],t[u+1],o);return o&&b(o,o.next)&&(j(o),o=o.next),o}function u(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!b(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(j(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function o(t,n,e,r,i,c,h){if(t){!h&&c&&function(t,n,e,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,u,o,a,l,f=1;do{for(e=t,t=null,u=null,o=0;e;){for(o++,r=e,a=0,n=0;n<f&&(a++,r=r.nextZ);n++);for(l=f;a>0||l>0&&r;)0!==a&&(0===l||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,l--),u?u.nextZ=i:t=i,i.prevZ=u,u=i;e=r}u.nextZ=null,f*=2}while(o>1)}(i)}(t,r,i,c);for(var y,v,x=t;t.prev!==t.next;)if(y=t.prev,v=t.next,c?l(t,r,i,c):a(t))n.push(y.i/e),n.push(t.i/e),n.push(v.i/e),j(t),t=v.next,x=v.next;else if((t=v)===x){h?1===h?o(t=f(u(t),n,e),n,e,r,i,c,2):2===h&&s(t,n,e,r,i,c):o(u(t),n,e,r,i,c,1);break}}}function a(t){var n=t.prev,e=t,r=t.next;if(g(n,e,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(x(n.x,n.y,e.x,e.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(t,n,e,r){var i=t.prev,u=t,o=t.next;if(g(i,u,o)>=0)return!1;for(var a=i.x<u.x?i.x<o.x?i.x:o.x:u.x<o.x?u.x:o.x,l=i.y<u.y?i.y<o.y?i.y:o.y:u.y<o.y?u.y:o.y,f=i.x>u.x?i.x>o.x?i.x:o.x:u.x>o.x?u.x:o.x,s=i.y>u.y?i.y>o.y?i.y:o.y:u.y>o.y?u.y:o.y,c=p(a,l,n,e,r),h=p(f,s,n,e,r),y=t.prevZ,v=t.nextZ;y&&y.z>=c&&v&&v.z<=h;){if(y!==t.prev&&y!==t.next&&x(i.x,i.y,u.x,u.y,o.x,o.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v!==t.prev&&v!==t.next&&x(i.x,i.y,u.x,u.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=c;){if(y!==t.prev&&y!==t.next&&x(i.x,i.y,u.x,u.y,o.x,o.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=h;){if(v!==t.prev&&v!==t.next&&x(i.x,i.y,u.x,u.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function f(t,n,e){var r=t;do{var i=r.prev,o=r.next.next;!b(i,o)&&m(i,r,r.next,o)&&k(i,o)&&k(o,i)&&(n.push(i.i/e),n.push(r.i/e),n.push(o.i/e),j(r),j(r.next),r=t=o),r=r.next}while(r!==t);return u(r)}function s(t,n,e,r,i,a){var l=t;do{for(var f=l.next.next;f!==l.prev;){if(l.i!==f.i&&d(l,f)){var s=O(l,f);return l=u(l,l.next),s=u(s,s.next),o(l,n,e,r,i,a),void o(s,n,e,r,i,a)}f=f.next}l=l.next}while(l!==t)}function c(t,n){return t.x-n.x}function h(t,n){if(n=function(t,n){var e,r=n,i=t.x,u=t.y,o=-1/0;do{if(u<=r.y&&u>=r.next.y&&r.next.y!==r.y){var a=r.x+(u-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o){if(o=a,a===i){if(u===r.y)return r;if(u===r.next.y)return r.next}e=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!e)return null;if(i===o)return e;var l,f=e,s=e.x,c=e.y,h=1/0;r=e;do{i>=r.x&&r.x>=s&&i!==r.x&&x(u<c?i:o,u,s,c,u<c?o:i,u,r.x,r.y)&&(l=Math.abs(u-r.y)/(i-r.x),k(r,t)&&(l<h||l===h&&(r.x>e.x||r.x===e.x&&y(e,r)))&&(e=r,h=l)),r=r.next}while(r!==f);return e}(t,n)){var e=O(n,t);u(n,n.next),u(e,e.next)}}function y(t,n){return g(t.prev,t,n.prev)<0&&g(n.next,t,t.next)<0}function p(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-e)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function v(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function x(t,n,e,r,i,u,o,a){return(i-o)*(n-a)-(t-o)*(u-a)>=0&&(t-o)*(r-a)-(e-o)*(n-a)>=0&&(e-o)*(u-a)-(i-o)*(r-a)>=0}function d(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&m(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(k(t,n)&&k(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,u=(t.y+n.y)/2;do{e.y>u!=e.next.y>u&&e.next.y!==e.y&&i<(e.next.x-e.x)*(u-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(g(t.prev,t,n.prev)||g(t,n.prev,n))||b(t,n)&&g(t.prev,t,t.next)>0&&g(n.prev,n,n.next)>0)}function g(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function b(t,n){return t.x===n.x&&t.y===n.y}function m(t,n,e,r){var i=_(g(t,n,e)),u=_(g(t,n,r)),o=_(g(e,r,t)),a=_(g(e,r,n));return i!==u&&o!==a||(!(0!==i||!w(t,e,n))||(!(0!==u||!w(t,r,n))||(!(0!==o||!w(e,t,r))||!(0!==a||!w(e,n,r)))))}function w(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function _(t){return t>0?1:t<0?-1:0}function k(t,n){return g(t.prev,t,t.next)<0?g(t,n,t.next)>=0&&g(t,t.prev,n)>=0:g(t,n,t.prev)<0||g(t,t.next,n)<0}function O(t,n){var e=new N(t.i,t.x,t.y),r=new N(n.i,n.x,n.y),i=t.next,u=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,u.next=r,r.prev=u,r}function P(t,n,e,r){var i=new N(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function j(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function N(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,n,e,r){for(var i=0,u=n,o=e-r;u<e;u+=r)i+=(t[o]-t[u])*(t[u+1]+t[o+1]),o=u;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,n,e,r){var i=n&&n.length,u=i?n[0]*e:t.length,o=Math.abs(S(t,0,u,e));if(i)for(var a=0,l=n.length;a<l;a++){var f=n[a]*e,s=a<l-1?n[a+1]*e:t.length;o-=Math.abs(S(t,f,s,e))}var c=0;for(a=0;a<r.length;a+=3){var h=r[a]*e,y=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((t[h]-t[p])*(t[y+1]-t[h+1])-(t[h]-t[y])*(t[p+1]-t[h+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},r.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var u=0;u<t[i].length;u++)for(var o=0;o<n;o++)e.vertices.push(t[i][u][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e}},function(t,n,e){t.exports=function(t,n,e,r,i){("number"!=typeof t||isNaN(t))&&(t=0),("number"!=typeof n||isNaN(n))&&(n=0),("number"!=typeof e||isNaN(e))&&(e=10),("number"!=typeof r||isNaN(r))&&(r=10);var u=25,o=.5;function a(t){return!!t&&("number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.w&&"number"==typeof t.h&&(!(isNaN(t.x)||isNaN(t.y)||isNaN(t.w)||isNaN(t.h))&&!(t.w<0||t.h<0)))}function l(t,n){return t.x==n.x&&t.y==n.y&&t.w==n.w&&t.h==n.h}function f(t,n,e,r){return{x:t,y:n,w:e,h:r,c:[],l:[],n:[]}}i&&("number"==typeof i.maxchildren&&i.maxchildren>0&&(u=i.maxchildren),"number"==typeof i.leafratio&&i.leafratio>=0&&(o=i.leafratio));var s=f(t,n,e,r);function c(t,n,e,r){return Math.sqrt((e-t)*(e-t)+(r-n)*(r-n))}function h(t,n,e){if(!t||!n)return!0;var r=function(t,n,e,r,i,u,o){o||(o=-1);var a=i*i+u*u;if(0==a)return null;if(a=(t*u-n*i-e*u+r*i)/a,Math.abs(i)>Math.abs(u))var l=(t-e-a*u)/i;else l=(n-r+a*i)/u;return l>=0&&l<=o||o<0?{s:l,t:a,x:e+l*i,y:r+l*u,dist:Math.abs(a)}:l<0?{s:l,dist:c(t,n,e,r)}:{s:l,dist:c(t,n,e+o*i,r+o*u)}}(n.x+.5*n.w,n.y+.5*n.h,t.x,t.y,t.dx,t.dy,t.dist);if(r){if(r.dist-=e,r.dist<0)return!0;if(r.dist*r.dist<=n.w*n.w+n.h*n.h)return!0}return!1}function y(t,n,e){return!t||!n||!(t.x+t.w<n.x-e||t.y+t.h<n.y-e||t.x-e>n.x+n.w||t.y-e>n.y+n.h)}function p(t,n){var e=!1;n.w*n.h>t.w*t.h*o&&(e=!0),(n.x<t.x||n.y<t.y||n.x+n.w>t.x+t.w||n.y+n.h>t.y+t.h)&&(e=!0);for(var r=null,i=0;i<t.n.length;i++)if(y(n,t.n[i],0)){if(r){e=!0;break}r=t.n[i]}return{leaf:e,childnode:r}}function v(t,n){var e=p(t,n);if(e.leaf)t.l.push(n);else{if(!e.childnode)return;d(e.childnode,n)}}function x(t,n){t.x="number"==typeof n.x?n.x:t.x,t.y="number"==typeof n.y?n.y:t.y,t.w="number"==typeof n.w?n.w:t.w,t.h="number"==typeof n.h?n.h:t.h}function d(t,n){if(a(n))if(0==t.n.length){if(t.c.push(n),t.c.length>u){var e=t.w/2,r=t.h/2;t.n.push(f(t.x,t.y,e,r),f(t.x+e,t.y,e,r),f(t.x,t.y+r,e,r),f(t.x+e,t.y+r,e,r));for(var i=0;i<t.c.length;i++)v(t,t.c[i]);t.c=[]}}else v(t,n)}function g(t,n,e,r,i,u){for(var o=0;o<n.l.length;o++)if(!i||t(e,n.l[o],r))if("object"==typeof u)u.push(n.l[o]);else if(!u(n.l[o]))return!1;for(o=0;o<n.c.length;o++)if(!i||t(e,n.c[o],r))if("object"==typeof u)u.push(n.c[o]);else if(!u(n.c[o]))return!1;for(var a=0;a<n.n.length;a++)if(t(e,n.n[a],r))if("object"==typeof u)u.concat(g(t,n.n[a],e,r,i,u));else if(!g(t,n.n[a],e,r,i,u))return!1;return!0}function b(t,n,e,r){return g(y,t,n,e,!0,r)}function m(t,n,e,r){if("function"!=typeof e&&"object"!=typeof e||void 0!==r||(r=e,e=0),void 0===r&&(r=[],e=0),null==n?b(t,n,e,r):"number"!=typeof n.x||"number"!=typeof n.y||isNaN(n.x)||isNaN(n.y)||("number"!=typeof n.dx||"number"!=typeof n.dy||isNaN(n.dx)||isNaN(n.dy)?"number"!=typeof n.w||"number"!=typeof n.h||isNaN(n.w)||isNaN(n.h)||b(t,n,e,r):function(t,n,e,r){g(h,t,n,e,!1,r)}(t,n,e,r)),"object"==typeof r)return r}return{get:function(t,n,e){return m(s,t,n,e)},put:function(t){d(s,t)},update:function(t,n,e){return function t(n,e,r,i){if("object"==typeof r&&void 0===i&&(i=r,r=!1),!a(e)||void 0===i)return!1;r?"string"!=typeof r&&(r="id"):r=!1;for(var u=0;u<n.c.length;u++)if(r&&n.c[u][r]==e[r]||!r&&l(n.c[u],e)){return x(o=n.c[u],i),(o.x>n.x+n.w||o.y>n.y+n.h||o.x+o.w<n.x||o.y+o.h<n.y)&&(n.c.splice(u,1),d(s,o)),!0}for(u=0;u<n.l.length;u++)if(r&&n.l[u][r]==e[r]||!r&&l(n.l[u],e)){var o;return x(o=n.l[u],i),(o.x>n.x+n.w||o.y>n.y+n.h||o.x+o.w<n.x||o.y+o.h<n.y)&&(n.l.splice(u,1),d(s,o)),!0}var f=p(n,e);return!(f.leaf||!f.childnode||!t(f.childnode,e,r))}(s,t,n,e)},remove:function(t,n){return function t(n,e,r){if(!a(e))return 0;r?"string"!=typeof r&&(r="id"):r=!1;for(var i=0,u=0;u<n.c.length;u++)(r&&n.c[u][r]==e[r]||!r&&l(n.c[u],e))&&(i++,n.c.splice(u,1),u--);for(u=0;u<n.l.length;u++)(r&&n.l[u][r]==e[r]||!r&&l(n.l[u],e))&&(i++,n.l.splice(u,1),u--);var o=p(n,e);return!o.leaf&&o.childnode?i+t(o.childnode,e,r):i}(s,t,n)},clear:function(){s=f(t,n,e,r)},stringify:function(){var i={x:t,y:n,w:e,h:r,maxc:u,leafratio:o,root:s};try{return JSON.stringify(i)}catch(t){return null}},parse:function(i){"string"==typeof i&&(i=JSON.parse(i)),t=i.x,n=i.y,e=i.w,r=i.h,u=i.maxc,o=i.leafratio,s=i.root}}}},function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n),e.d(n,"Point",(function(){return I})),e.d(n,"Vector",(function(){return i})),e.d(n,"isclose",(function(){return a})),e.d(n,"clip",(function(){return l})),e.d(n,"dot",(function(){return u})),e.d(n,"cross",(function(){return o})),e.d(n,"Edge",(function(){return F})),e.d(n,"Polygon",(function(){return T})),e.d(n,"NavMesh",(function(){return V}));var i=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var n,e,i;return n=t,(e=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return a(this.x,t.x)&&a(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(l(-1,1,u(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return o(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&r(n.prototype,e),i&&r(n,i),t}();function u(t,n){return t.x*n.x+t.y*n.y}function o(t,n){return t.x*n.y-t.y*n.x}function a(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return t>n-e&&t<n+e}function l(t,n,e){return e<t?t:e>n?n:e}var f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),s=new Uint8Array(16);function c(){if(!f)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(s)}var h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var y=function(t){return"string"==typeof t&&h.test(t)},p=[],v=0;v<256;++v)p.push((v+256).toString(16).substr(1));var x=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(p[t[n+0]]+p[t[n+1]]+p[t[n+2]]+p[t[n+3]]+"-"+p[t[n+4]]+p[t[n+5]]+"-"+p[t[n+6]]+p[t[n+7]]+"-"+p[t[n+8]]+p[t[n+9]]+"-"+p[t[n+10]]+p[t[n+11]]+p[t[n+12]]+p[t[n+13]]+p[t[n+14]]+p[t[n+15]]).toLowerCase();if(!y(e))throw TypeError("Stringified UUID is invalid");return e};var d=function(t,n,e){var r=(t=t||{}).random||(t.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){e=e||0;for(var i=0;i<16;++i)n[e+i]=r[i];return n}return x(r)},g=e(0),b=e.n(g),m=e(1),w=e.n(m),_=e(2),k=e.n(_);class O{constructor(t=[],n=P){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,u=n[i];if(e(r,u)>=0)break;n[t]=u,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),u=n[r];const o=r+1;if(o<this.length&&e(n[o],u)<0&&(r=o,u=n[o]),e(u,i)>=0)break;n[t]=u,t=r}n[t]=i}}function P(t,n){return t<n?-1:t>n?1:0}function j(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function N(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?j(Object(e),!0).forEach((function(n){S(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):j(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function S(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function E(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var e=[],r=!0,i=!1,u=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(e.push(o.value),!n||e.length!==n);r=!0);}catch(t){i=!0,u=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Z(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function M(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,n,e){return n&&M(t.prototype,n),e&&M(t,e),t}function q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function C(t,n,e){return(C=q()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&z(i,e.prototype),i}).apply(null,arguments)}function z(t,n){return(z=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function D(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function R(t){return t instanceof Array?C(i,D(t)):t instanceof i?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new i(t.x,t.y):void 0}var F=function(){function t(n,e){Z(this,t),this._uuid=d(),this.p1=R(n),this.p2=R(e)}return A(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=R(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=u(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof i?t:t.p1.sub(t.p2);return a(o(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return a(o(n,e),0)&&a(o(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),C(t,D(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),T=function(){function t(n){Z(this,t),this._uuid=d(),this.points=n.map(R),this.bounds=this._computeBounds()}return A(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new F(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new i(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=R(t);var n=this.points.map(this._toPointArray);return b()(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=R(t);var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if(o.onEdge(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"touches",value:function(t){var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if((o.onEdge(t.p1)||o.onEdge(t.p2))&&o.collinear(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"boundsSize",value:function(){var t=E(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),V=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z(this,t),this._uuid=d(),this.polygons=this._triangulate(n).map((function(t){return new T(t)})),this.costFunc=e,this.heuristicFunc=r,this._buildQuadtree(),this._buildNeighbors()}return A(t,[{key:"_triangulate",value:function(t){var n=this,e=[],r=!0,i=!1,u=void 0;try{for(var o,a=function(){for(var t=o.value,r=w()(n._flatten(t)),i=0;i<r.length/3;i++){var u=r.slice(3*i,3*i+3);e.push(u.map((function(n){return t[n]})))}},l=t[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)a()}catch(t){i=!0,u=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw u}}return e}},{key:"_flatten",value:function(t){var n=[],e=!0,r=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value;a instanceof Array?n.push.apply(n,D(a)):n.push(a.x,a.y)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return n}},{key:"_buildQuadtree",value:function(){this.qt=k()(-1/0,-1/0,1/0,1/0);var t=!0,n=!1,e=void 0;try{for(var r,i=this.polygons[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var u=r.value;this.qt.put(N({},u.boundsSize(),{polygon:u}))}}catch(t){n=!0,e=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw e}}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t],e=!0,r=!1,i=void 0;try{for(var u,o=this.qt.get(n.boundsSize())[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value.polygon;if(n!==a&&!n.neighbors.hasOwnProperty(a._uuid)){var l=this._computePortal(n,a);null!==l&&l.length()>0&&(n.neighbors[a._uuid]={polygon:a,portal:l},a.neighbors[n._uuid]={polygon:n,portal:l})}}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"_computePortal",value:function(t,n){var e=!0,r=!1,i=void 0;try{for(var u,o=t.edges()[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value,l=n.touches(a);if(null!==l)return a.overlap(l)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return null}},{key:"findPath",value:function(t,n){t=R(t),n=R(n);var e=this._findPath(t,n);return e&&this._funnel(t,n,e)}},{key:"_findPath",value:function(t,n){var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);if(null===e||null===r)return null;for(var i=new O([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),u=S({},e._uuid,null),o=S({},e._uuid,0);i.length;){var a=i.pop().polygon;if(a._uuid===r._uuid)break;for(var l=0,f=Object.values(a.neighbors);l<f.length;l++){var s=f[l].polygon,c=o[a._uuid]+this._computeCost(a,s);(!o.hasOwnProperty(s._uuid)||c<o[s._uuid])&&(i.push({cost:c+this._heuristic(s,r),polygon:s}),o[s._uuid]=c,u[s._uuid]=a)}}return this._reconstructPath(r,u)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){if(null!==this.costFunc){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}return this._computeDistance(t,n)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:null!==this.heuristicFunc?this.heuristicFunc(t,n):this._computeDistance(t,n)}},{key:"_findContainingPolygon",value:function(t){var n=.01*t.x,e={x:.99*t.x-n,y:.99*t.y-n,w:2*n,h:2*n},r=!0,i=!1,u=void 0;try{for(var o,a=this.qt.get(e)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(l.polygon.contains(t))return l.polygon}}catch(t){i=!0,u=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];for(var r=[t],i=null,u=null,o=0;o<e.length-1;o++){var a=e[o],l=e[o+1],f=a.neighbors[l._uuid].portal,s=E(this._pointPortalEdges(t,f),2),c=s[0],h=s[1];if(null!==i&&null!==u&&(c=this._funnelEdge(i,u,c),h=this._funnelEdge(u,i,h),null===c||null===h)){var y=null===c?u:i,p=this._splitAt(e.slice(o-1),y.p2);r.push.apply(r,D(this._funnel(y.p2,n,p)));break}if(i=c,u=h,o===e.length-2){var v=new F(t,n),x=this._funnelEdge(i,u,v);x===i?r.push(i.p2):null===x&&r.push(u.p2),r.push(n)}}return r}},{key:"_pointPortalEdges",value:function(t,n){return o(n.p1.sub(t),n.p2.sub(t))<0?[new F(t,n.p2),new F(t,n.p1)]:[new F(t,n.p1),new F(t,n.p2)]}},{key:"_splitAt",value:function(t,n){var e=t.indexOf(D(t).reverse().find((function(t){return t.contains(n)})));return t.slice(e)}},{key:"_funnelEdge",value:function(t,n,e){var r=t.direction(),i=n.direction(),u=e.direction();return o(r,i)*o(r,u)<0?t:r.angle(u)<=r.angle(i)?e:null}}]),t}(),I=i}])}));
//# sourceMappingURL=nav2d_deps.min.js.map